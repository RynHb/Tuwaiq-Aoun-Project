<!DOCTYPE html>
<html dir="rtl" xmlns="http://www.w3.org/1999/html">
  <head>
    <link href='https://fonts.googleapis.com/css?family=Tajawal' rel='stylesheet'>
    <title>المجيب الذكي</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="style2.css">
  </head>
  <body>

    <main>
      <section>
        <div class="card">
          <br>
        <div class="heading">
          <h3>اسأل المجيب الذكي</h3>
        </div>
        <p>
          بإمكانك الاستفسار عن قوانين العمل والحصول على إجابة من خلال المجيب
          الذكي
        </p>
        <form method="post">

          <input
            type="text"
            name="question"
            placeholder="أكتب سؤالك هنا .."
            required=""
          />

          <input type="submit" value="اسأل" />

        </form>

        <div class="dot-pulse"></div>

        <div class="result"></div>
          <br>
        </div>
      </section>
    </main>

    <script>
      document
        .querySelector("form")
        .addEventListener("submit", async (event) => {
          event.preventDefault();

          const question = document.querySelector(
            'input[name="question"]'
          ).value;
          const loadingDiv = document.querySelector(".dot-pulse");
          const resultDiv = document.querySelector(".result");

          loadingDiv.style.display = "block";
          resultDiv.style.display = "none";

          try {
            const response = await fetch("http://127.0.0.1:5000/gpt", {
              method: "POST",
              body: JSON.stringify({ question: question }),
              headers: {
                "Content-Type": "application/json",
              },
            });

            if (!response.ok) {
              throw new Error("Request failed");
            }

            const data = await response.json();
            const answer = data.answer;

            resultDiv.textContent = answer;
          } catch (error) {
            resultDiv.textContent = error.message;
          } finally {
            loadingDiv.style.display = "none";
            resultDiv.style.display = "block";
          }
        });

        var name = localStorage.getItem("userName");
        var welcomeName = document.getElementById("welcomeName");
        welcomeName.textContent = name;
    </script>
  </body>
</html>
